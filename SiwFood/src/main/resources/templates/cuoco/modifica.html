<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Modifica Ricetta</title>
    <link rel="stylesheet" href="/css/cuoco/ricetteCuoco.css" />
</head>
<body>
    <h1>Modifica Ricetta</h1>

    <form th:action="@{'/loggedIn/ricetta/modifica/' + ${ricetta.id}}" th:object="${ricetta}" method="post">
        <div>
            <label>Nome:</label>
            <input type="text" th:field="${ricetta.nome}" required />
            <span th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></span>
        </div>
        <div>
            <label>Descrizione:</label>
            <textarea th:field="${ricetta.descrizione}" required></textarea>
            <span th:if="${#fields.hasErrors('descrizione')}" th:errors="*{descrizione}"></span>
        </div>

        <!-- Sezione per gestire gli ingredienti -->
        <h2 class="text-center my-4">Ingredienti della Ricetta</h2>
        <div id="ingredienti-section" class="scrollable-container">
            <div th:each="rigaRicetta, rigaIndex : ${ricetta.righeRicetta}" class="row align-items-center mb-2 ingredienti-group">
                <div class="col-md-7">
                    <select class="form-control" name="ingredientiIds">
                        <option th:each="ing : ${ingredienti}" th:value="${ing.id}" th:text="${ing.nome}" th:selected="${ing.id == rigaRicetta.ingrediente.id}"></option>
                    </select>
                </div>
                <div class="col-3 p-1">
                    <input type="text" class="form-control" name="quantita" th:value="${rigaRicetta.quantita}" placeholder="Quantità" required />
                </div>
                <div class="col-1 p-0">
                    <button type="button" class="btn btn-danger remove-ingrediente">Rimuovi</button>
                </div>
            </div>
        </div>

        <!-- Template per aggiungere un nuovo ingrediente -->
        <template id="ingredient-template">
            <div class="row align-items-center mb-2 ingredienti-group">
                <div class="col-md-7">
                    <select class="form-control" name="ingredientiIds" required>
                        <option th:each="ing : ${ingredienti}" th:value="${ing.id}" th:text="${ing.nome}"></option>
                    </select>
                </div>
                <div class="col-3 p-1">
                    <input type="text" class="form-control" name="quantita" placeholder="Quantità" required />
                </div>
                <div class="col-1 p-0">
                    <button type="button" class="btn btn-danger remove-ingrediente">Rimuovi</button>
                </div>
            </div>
        </template>

        <!-- Pulsante per aggiungere un nuovo ingrediente -->
        <div class="d-flex justify-content-center my-4">
            <button type="button" class="btn btn-primary" id="add-ingrediente">Aggiungi Ingrediente</button>
        </div>

        <div>
            <button type="submit" class="btn btn-primary">Salva Modifiche</button>
        </div>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const addButton = document.getElementById('add-ingrediente');
            const ingredientiSection = document.getElementById('ingredienti-section');
            const ingredientTemplate = document.getElementById('ingredient-template').content;

            addButton.addEventListener('click', function () {
                const clone = document.importNode(ingredientTemplate, true);
                ingredientiSection.appendChild(clone);
            });

            ingredientiSection.addEventListener('click', function (event) {
                if (event.target.closest('.remove-ingrediente')) {
                    const row = event.target.closest('.ingredienti-group');
                    if (row) {
                        row.remove();
                    }
                }
            });
        });
    </script>
</body>
</html>
